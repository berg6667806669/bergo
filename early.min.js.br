
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="e6edb5c3-f639-5943-9b66-a690eeb20457")}catch(e){}}();
function j(t,s){let l=t?"/api/livegraph-next":"/api/livegraph",r=location.host;return r==="admin.staging.figma.com"?r="staging.figma.com":r==="admin.figma.com"&&(r="www.figma.com"),`${location.protocol==="https:"?"wss":"ws"}://${r}${l}?${s}`}function D(t,s){return j(!!t,s??"")}self.global=self;var N=101,E=class extends WebSocket{constructor(e,n,l=void 0){super(e,n);this.onCloseTriggered=l;this.events=[];this._readyToFlush=()=>{};super.onclose=this.onClose,super.onopen=this.onOpen,super.onmessage=this.onMessage,super.onerror=this.onError,new Promise(r=>{let i=!1;this._readyToFlush=()=>{i||(i=!0,setTimeout(r,0))}}).then(()=>{this.events.forEach(({event:r,ev:i})=>{var o,a,d,c;switch(r){case"onmessage":(o=super.onmessage)==null||o.call(this,i);break;case"onopen":(a=super.onopen)==null||a.call(this,i);break;case"onclose":(d=super.onclose)==null||d.call(this,i);break;case"onerror":(c=super.onerror)==null||c.call(this,i);break}})})}onMessage(e){this.events.push({event:"onmessage",ev:e})}onOpen(e){this.events.push({event:"onopen",ev:e})}onClose(e){var n;(n=this.onCloseTriggered)==null||n.call(this),this.events.push({event:"onclose",ev:e})}onError(e){this.events.push({event:"onerror",ev:e})}set onclose(e){super.onclose=e,this._readyToFlush()}set onopen(e){super.onopen=e,this._readyToFlush()}set onmessage(e){super.onmessage=e,this._readyToFlush()}set onerror(e){super.onerror=e,this._readyToFlush()}},z=(t,s,e,n)=>{if(t)window.userStateXHR={readyState:4,status:200,responseText:t};else if(window.Fig){if(n||!window.INITIAL_OPTIONS.user_data){window.startUserStateXHR=()=>{};return}window.startUserStateXHR=function(i){var u;var o="/api/user/state",a=[];window.INITIAL_OPTIONS.org_id&&a.push("org_id="+window.INITIAL_OPTIONS.org_id),window.INITIAL_OPTIONS.team_id&&a.push("team_id="+window.INITIAL_OPTIONS.team_id),e&&a.push("omit_core_data=1"),i&&a.push("file_key="+i),a.length!==0&&(o+="?"+a.join("&")),window.userStateXHR=new XMLHttpRequest,window.userStateXHR.open("GET",o);let d=(u=window.INITIAL_OPTIONS.user_data)==null?void 0:u.id;d&&window.userStateXHR.setRequestHeader("X-Figma-User-ID",d),window.userStateXHR.send();var c=window.performance?window.performance.now():-1;window.userStateXHR.addEventListener("load",function(){window.userStateXHRDuration=window.performance?window.performance.now()-c:-1},!1),window.sessionStateXHR=new XMLHttpRequest,window.sessionStateXHR.open("GET","/api/session/state"),d&&window.sessionStateXHR.setRequestHeader("X-Figma-User-ID",d),window.sessionStateXHR.send()};let l=location.pathname==="/preload-editor"||location.pathname==="/preload-android-proto"||location.pathname==="/file/new",r=window.INITIAL_OPTIONS.editing_file&&window.INITIAL_OPTIONS.editing_file.key;s?window.startUserStateXHR(r):l||window.startUserStateXHR()}};function C(t){return t==="dark"?"1E1E1E":"F5F5F5"}function X(){let t=null;try{t=window.localStorage}catch{}return t}function Q(){var e;if(!((e=window.INITIAL_OPTIONS.feature_flags)!=null&&e.send_initial_bg_color))return"";let t=W(X()),s=V(t);return C(s)}var G="global-debug-theme-preference";function W(t){var s;if(t){let e=t==null?void 0:t.getItem(G);return(s=window.INITIAL_OPTIONS.feature_flags)!=null&&s.ee_system_theme_default&&!e?"system":e}return null}var x=window.matchMedia("(prefers-color-scheme: dark)");function V(t){return t==="system"?x.matches?"dark":"light":t==="dark"?"dark":"light"}var $="chunked-file-load",J="file-load-streaming-compression",Z=5e3,ee="send-file-directly";function te(){var e,n,l;if(!((n=(e=window.INITIAL_OPTIONS)==null?void 0:e.feature_flags)!=null&&n.manifest_commit_sha))return N;let t=(l=window.INITIAL_OPTIONS)==null?void 0:l.cluster_name;if(t!=="staging"&&t!=="local")return N;let s=window.location.search;if(s.includes("force-client-version")){let i=new URLSearchParams(s).get("force-client-version");if(i){let o=parseInt(i);if(!isNaN(o)&&o>0)return console.log(`!! Overriding client version to ${o}`),o}}return N}var se=(t,s)=>{var r;let e=(r=window.INITIAL_OPTIONS.user_data)==null?void 0:r.id,n=window.INITIAL_OPTIONS.tracking_session_id,l=window.INITIAL_OPTIONS.release_manifest_git_commit;window.mpGlobal={version:te(),sock:null,msgs:[],perfMetrics:[],shouldConnectToMultiplayer:t,url({fileKey:i,role:o,oauthToken:a,nodeIds:d,initialBgColor:c,suppressDecodeErrors:u,connectionType:T,tagForLogging:h,forceViewOnly:S}){var P,v,A,R,k,b,y,F,U,M,H;if(!t)return"";let g=null;s&&i===s.fileKey&&s.targetFileVersion&&(g=s.targetFileVersion);let I="";(o==="editor"||o==="viewerWithCpp")&&d&&(I+=`&scenegraph-queries-initial-nodes=${d}`);let f=window.location.search,w=new URLSearchParams(f);o==="editor"&&(s==null?void 0:s.forceIncrementalForEditors)===1&&!((P=window.INITIAL_OPTIONS.feature_flags)!=null&&P.recovery_mode&&w.get("recovery")==="true")?I+="&use-incremental-for-editors=1":((s==null?void 0:s.forceIncrementalForEditors)===0||(v=window.INITIAL_OPTIONS.feature_flags)!=null&&v.recovery_mode&&w.get("recovery")==="true")&&(I+="&use-incremental-for-editors=0"),o==="editor"&&((A=window.INITIAL_OPTIONS.feature_flags)!=null&&A.incremental_loading_validation)&&(I+="&incremental-loading-validation=1");let _=1;try{let O=JSON.parse(sessionStorage.getItem("reload_times")||"[0]"),Y=O[O.length-1];_=Date.now()-Y<5e3?1:0}catch{}(o!=="editor"||!((R=window.INITIAL_OPTIONS.feature_flags)!=null&&R.send_initial_bg_color))&&(c="");let m=(k=window.INITIAL_OPTIONS.feature_flags)==null?void 0:k.send_file_directly,p=((b=window.INITIAL_OPTIONS.feature_flags)==null?void 0:b.chunked_file_load)&&T==="initial-load",q=(y=window.INITIAL_OPTIONS.feature_flags)!=null&&y.chunked_size_1000?1e3:(F=window.INITIAL_OPTIONS.feature_flags)!=null&&F.chunked_size_5000?5e3:(U=window.INITIAL_OPTIONS.feature_flags)!=null&&U.chunked_size_10000?1e4:(M=window.INITIAL_OPTIONS.feature_flags)!=null&&M.chunked_size_20000?2e4:Z,B=(H=window.INITIAL_OPTIONS.feature_flags)==null?void 0:H.file_load_streaming_compression,K=window.INITIAL_OPTIONS.e2e_traffic,L=window.INITIAL_OPTIONS.e2e_test_name;return`${location.protocol.replace("http","ws")}//${location.host}/api/multiplayer/${i}?role=${o}&tracking_session_id=${n}&version=${this.version}&recentReload=${_}`+(a?"&oauth_token="+a:"")+I+(e?`&user-id=${e}`:"")+(g?`&target-file-version=${g}`:"")+(l?`&client_release=${l}`:"")+(c?`&initial-bg-color=${c}`:"")+(u?"&suppress-decode-errors":"")+(p?`&${$}`:"")+(p?`&chunk-size=${q}`:"")+(B?`&${J}`:"")+(m?`&${ee}`:"")+(h?`&tag-for-logging=${h}`:"")+(K?"&e2e_traffic=true":"")+(L?`&e2e_test_name=${L}`:"")+(S?"&force-view-only":"")},DEBUG_THEME_PREFERENCE_KEY:G,DARK_THEME_MEDIA_QUERY:x,themePreferenceFromLocalStorage:W,getBackgroundColorForTheme:C,getVisibleTheme:V,REQUEST_CHUNKED_FILE_LOAD_PARAM:$,preconnect(i){if(t!==!1){if(this.sock){if(i===this.sock.url&&this.sock.readyState!==WebSocket.CLOSED)return;try{this.sock.close()}catch{}}this.sock=new WebSocket(i),this.sock.binaryType="arraybuffer",this.sock.onopen=o=>{this.perfMetrics.push({key:"mp-ws-onopen",ts:performance.now(),nBytes:void 0})},this.sock.onmessage=o=>{let a=new Uint8Array(o.data);this.msgs.push(a),this.perfMetrics.push({key:"mp-ws-onmessage",ts:performance.now(),nBytes:a.length*a.BYTES_PER_ELEMENT})},this.msgs=[],this.perfMetrics=[]}}},s&&mpGlobal.preconnect(mpGlobal.url(s))},ne=t=>{let s=()=>{let n=document.createElement("script");return n.type="text/javascript",n.async=!0,n.setAttribute("nonce",window.INITIAL_OPTIONS.csp_nonce),n.crossOrigin="anonymous",n},e=new Promise((n,l)=>{let r=s();r.onload=n,r.src=t,document.head.appendChild(r)});return e.catch(n=>console.error(`Fetching ${t} failed: ${n}`)),e};(()=>{var a,d,c,u,T,h,S,g,I;let{file_minimal_user_state:t,mock_user_state_for_tests_json:s,multiplayer_preconnect_options:e,omit_core_data:n,omit_user_state:l,preload_fullscreen_urls:r,should_connect_to_multiplayer:i}=window.EARLY_ARGS||{};if(window.INITIAL_OPTIONS||(window.INITIAL_OPTIONS={}),z(s,!!t,!!n,!!l),!/iPhone|iPad|iPod/.test(navigator.userAgent)&&((d=(a=window.INITIAL_OPTIONS)==null?void 0:a.feature_flags)!=null&&d.lg_early_connection)){let f=(u=(c=window.INITIAL_OPTIONS)==null?void 0:c.feature_flags)==null?void 0:u.livegraph_connect_next,w=new URLSearchParams((T=window.INITIAL_OPTIONS)==null?void 0:T.page_load_token);w.append("userId",((h=window.INITIAL_OPTIONS.user_data)==null?void 0:h.id)||"");let _=!!window.__figmaDesktop;w.append("clientType",_?"desktop":"web");let m=D(f,w.toString());window.LGEarlyWS=new E(m,void 0,()=>{window.LGEarlyWS=void 0})}if(e&&(e.initialBgColor=Q(),e.connectionType="initial-load",e.forceViewOnly=!1,(((S=window.INITIAL_OPTIONS)==null?void 0:S.cluster_name)==="staging"||((g=window.INITIAL_OPTIONS)==null?void 0:g.cluster_name)==="local")&&((I=X())!=null&&I.getItem("force-vscode"))?e.forceViewOnly=!0:e.forceViewOnly=(window==null?void 0:window.location.ancestorOrigins)&&[...window.location.ancestorOrigins].some(f=>f.startsWith("vscode-webview://"))),se(i!==!1,e),!r&&!/FigmaMobile-Android/.test(navigator.userAgent)&&((e==null?void 0:e.role)==="editor"||(e==null?void 0:e.role)==="viewerWithCpp"||(e==null?void 0:e.role)==="prototype")){let f=(e==null?void 0:e.role)==="prototype"?Fig.prototypeLibURLs:Fig.fullscreenURLs,w=fetch(f["compiled_wasm.wasm"]);w.catch(m=>console.error(`Fetching compiled_wasm.wasm failed: ${m}`));let _=ne(f["compiled_wasm.js"]);window.FULLSCREEN_PRELOADS={wasm:w,js:_}}})();
/*! For license information please see early.min.js.LEGAL.txt */

//# debugId=e6edb5c3-f639-5943-9b66-a690eeb20457

//# sourceMappingURL=https://admin.figma.com/admin/esbuild-artifacts/cd7f8cca6d4a5de7f88dd4e9c59b286a0714fd52/js/early.min.js.map